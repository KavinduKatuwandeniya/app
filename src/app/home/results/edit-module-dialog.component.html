<button mat-icon-button class="close-button" (click)="onNoClick()">
  <mat-icon>close</mat-icon>
</button>

<h1 class="dialog-title" mat-dialog-title>Edit Module Information</h1>
<p class="dialog-subtitle">Edit required fields and click save</p>

<form [formGroup]="editModuleForm">
  <mat-dialog-content style="font-size: 14px; min-height: 300px !important;">

    <mat-spinner class="spinner" style="margin-top: 100px" [hidden]="!progress"></mat-spinner>

    <div [hidden]="progress" *ngIf="!error">

      <mat-form-field appearance="outline" id="form" class="input-field">
        <mat-label>Module Name</mat-label>
        <input type="text" matInput formControlName="moduleName" placeholder="Ex: Information Technology">
        <mat-error *ngIf="moduleName.touched && moduleName.errors?.required">This field is required</mat-error>
        <mat-error *ngIf="moduleName.touched && moduleName.errors?.minLength">Module name must be more than six
          characters long
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" style="width: 30%; margin-right: 5%" class="input-field">
        <mat-label>Module Code</mat-label>
        <input type="text" matInput formControlName="moduleCode" placeholder="Ex: CM 1100">
        <mat-error *ngIf="moduleCode.touched && moduleCode.errors?.required">Required</mat-error>
        <mat-error *ngIf="moduleCode.touched && moduleCode.errors?.pattern">Invalid format</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" style="width: 30%; margin-right: 5%" class="input-field">
        <mat-label>Credits</mat-label>
        <input matInput formControlName="credits" placeholder="Ex: 2">
        <mat-error *ngIf="credits.touched && credits.errors?.required">Required</mat-error>
        <mat-error *ngIf="credits.touched && credits.errors?.pattern">Invalid input</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" style="width: 30%" class="input-field">
        <mat-label>Semester</mat-label>
        <mat-select formControlName="semester">
          <mat-option value="1">L01S01</mat-option>
          <mat-option value="2">L01S02</mat-option>
          <mat-option value="3">L02S01</mat-option>
          <mat-option value="4">L02S02</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="input-field">
        <mat-label>Module Description</mat-label>
        <textarea style="overflow: hidden !important; resize: none !important;" rows="3" matInput
                  formControlName="description" placeholder="Add a description to this module"></textarea>
        <mat-error *ngIf="description.touched && description.errors?.required">This field is required</mat-error>
        <mat-error *ngIf="description.touched && description.errors?.minLength">Module description must be more than
          six
          characters long
        </mat-error>
      </mat-form-field>

      <div class="input-group" id="teachers">

        <div style="width: 100%">
          <p class="input-group-header">Add Teachers</p>
        </div>

        <p *ngIf="teachers.length === 0">
          Enter teachers ID number or name to assign the to this module <br/>
          <span class="text-danger" *ngIf="!enabled.value">You must add at least one teacher</span>
        </p>

        <mat-chip-list style="margin-bottom: 15px" #teacherList aria-label="Teacher Selection">
          <mat-chip *ngFor="let teacher of teachers"
                    [selectable]="selectable"
                    [removable]="removable"
                    (removed)="removeTeacher(teacher)"
                    class="mat-chip-edit-details">
            {{ teacher.username }} | {{ teacher.firstName + ' ' + teacher.lastName }}
            <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
          </mat-chip>
        </mat-chip-list>

        <mat-form-field appearance="outline" class="input-field"
                        style="margin-bottom: -5px !important; width: 80%; margin-right: 5%;">
          <mat-label>Teacher ID</mat-label>
          <input matInput
                 placeholder="Ex: 184061R"
                 type="text"
                 formControlName="teacher"
                 [matAutocomplete]="auto"/>
          <mat-error *ngIf="teacher.errors?.incorrect">Invalid teacher id</mat-error>
          <mat-autocomplete #auto='matAutocomplete'>
            <mat-option *ngFor="let teacher of filteredTeachers | async"
                        [value]="teacher.username">
              <span>{{ teacher.username }}</span> |
              <small>{{ teacher.firstName + ' ' + teacher.lastName }}</small>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <button mat-mini-fab type="button" color="primary" style="margin-top: 7px" (click)="addTeacher()">
          <mat-icon>add</mat-icon>
        </button>

      </div>

      <div class="input-group" id="lectureHours">

        <div style="width: 100%">
          <p class="input-group-header">Lecture Hours</p>
        </div>

        <p *ngIf="lectureHours.length === 0">
          To add lectures fill below details and click add button. <br/>
          <span class="text-danger" *ngIf="!enabled.value">You must add at least one lecture hour.</span>
        </p>

        <mat-chip-list style="margin-bottom: 15px" #lectureHourList aria-label="Lecture Hour Selection">
          <mat-chip *ngFor="let lectureHour of lectureHours"
                    [selectable]="selectable"
                    [removable]="removable"
                    (removed)="removeLectureHour(lectureHour)"
                    class="mat-chip-edit-details">
            {{lectureHour.type}} | {{getTime(lectureHour.startingTime)}} - {{ getTime(lectureHour.endingTime) }}
            | {{ lectureHour.day }} | {{ lectureHour.lectureHall }}
            <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
          </mat-chip>
        </mat-chip-list>

        <mat-form-field appearance="fill" class="input-field" style="width: 30%; margin-right: 5%">
          <mat-label>Type</mat-label>
          <mat-select formControlName="type">
            <mat-option *ngFor="let type of TYPES" [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="input-field" style="width: 30%; margin-right: 5%">
          <mat-label>Day</mat-label>
          <mat-select formControlName="day">
            <mat-option *ngFor="let day of DAYS_OF_WEEK" [value]="day">
              {{ day }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill" class="input-field" style="width: 30%">
          <mat-label>Lecture Hall</mat-label>
          <mat-select formControlName="lectureHall">
            <mat-option *ngFor="let lectureHall of LECTURE_HALLS" [value]="lectureHall">
              {{ lectureHall }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="input-field" style="width: 37%; margin-right: 5%">
          <mat-label>Starting Time</mat-label>
          <input matInput type="time" formControlName="startingTime"/>
        </mat-form-field>

        <mat-form-field appearance="outline" class="input-field" style="width: 37%; margin-right: 5%">
          <mat-label>Ending Time</mat-label>
          <input matInput type="time" formControlName="endingTime"/>
        </mat-form-field>

        <button mat-mini-fab color="primary" type="button" style="margin-top: 7px" (click)="addLecture()">
          <mat-icon>add</mat-icon>
        </button>

      </div>

      <mat-checkbox (change)="checkbox()" color="primary" formControlName="enabled">Set as disabled module
      </mat-checkbox>

    </div>

    <div *ngIf="error" class="alert alert-danger mt-3 mb-0">{{ error }}</div>

  </mat-dialog-content>

  <mat-dialog-actions style="margin-bottom: -10px" *ngIf="!error" [hidden]="progress">
    <button mat-raised-button color="primary" (click)="submitForm()">Save</button>
    <button mat-flat-button>Cancel</button>
  </mat-dialog-actions>

</form>
