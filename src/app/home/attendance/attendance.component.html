<div class="container-md" style="margin-left: 0; max-width: 1000px">

  <div class="jumbotron">
    <h3>Attendance</h3>
    <p *ngIf="getRole !== 'admin'; else adminBlock">You can check your attendance for each module with dates</p>
    <ng-template #adminBlock><p>You can perform any attendance related operations</p></ng-template>
  </div>

  <mat-form-field class="filter" [hidden]="getRole === 'admin'">
    <mat-label>Filter</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Enter keyword" #input/>
  </mat-form-field>

  <div *ngFor="let module of filteredAttendance" class="card" style="margin-bottom: 15px">

    <h5 class="card-header">
      <span style="float: left">{{ module.moduleName }}</span>
      <span style="float: right">{{ module.moduleCode }}</span>
    </h5>

    <div class="card-body" style="padding: 0">

      <div class="list-group list-group-flush">
        <a *ngFor="let lectureHour of module.attendance"
           (click)="openDialog(module.moduleCode, module.moduleName, lectureHour.type, module.batch)"
           class="list-group-item list-group-item-action d-flex">
          <div class="type">{{ lectureHour.type | uppercase }}</div>
          <div style="width: 33%; text-align: center">
            <mat-chip-list aria-label="attendance">
              <mat-chip class="attendance-success"
                        [class.attendance-danger]="lectureHour.percentage < 80">{{ lectureHour.percentage + '%' }}</mat-chip>
            </mat-chip-list>
          </div>
          <div style="width: 33%; text-align: right">
            <mat-icon>keyboard_arrow_right</mat-icon>
          </div>
        </a>
      </div>

    </div>

  </div>

  <div *ngIf="getRole === 'admin'">

    <div class="nav flex-column nav-pills secondary-nav" id="v-pills-tab" role="tablist" aria-orientation="vertical">
      <a class="nav-link active" id="upload-attendance-tab" data-toggle="pill" href="#upload-attendance" role="tab" aria-controls="upload-attendance" aria-selected="true">Upload Attendance</a>
      <a class="nav-link" id="modify-attendance-tab" data-toggle="pill" href="#modify-attendance" role="tab" aria-controls="modify-attendance" aria-selected="false">Modify Attendance</a>
      <a class="nav-link" id="view-attendance-tab" data-toggle="pill" href="#view-attendance" role="tab" aria-controls="view-attendance" aria-selected="false">View Attendance</a>
    </div>

    <div class="tab-content" id="v-pills-tabContent">
      <div class="tab-pane fade show active" id="upload-attendance" role="tabpanel" aria-labelledby="upload-attendance-tab">

        <div class="card" style="width: calc(100% - 260px); margin: auto; float: right">

          <div class="card-header">
            <h5>Upload Attendance</h5>
            <p style="margin-bottom: 0">Upload attendance related to any session</p>
          </div>

          <div class="card-body">

            <form [formGroup]="uploadAttendanceForm">

              <div>

                <mat-form-field appearance="outline" class="input-field" style="font-size: 15px; width: calc(100% - 45px); margin-right: 15px">
                  <mat-label>Module Code</mat-label>
                  <input type="text" matInput formControlName="moduleCode" placeholder="Ex: CM1100" (focusout)="checkIfModuleExists($event.target.value)"/>
                  <mat-error *ngIf="moduleCode.touched && moduleCode.errors?.required">This field is required</mat-error>
                  <mat-error *ngIf="moduleCode.touched && moduleCode.errors?.pattern">Invalid module Code</mat-error>
                  <mat-error *ngIf="moduleCode.touched && !moduleCode.errors?.pattern && !moduleCode.errors?.required && !moduleExists">Module does not exist</mat-error>
                  <mat-error *ngIf="moduleCode.touched && !moduleCode.errors?.pattern && !moduleCode.errors?.required && moduleExists && moduleError">No lecture hours found for this module! Please add lecture hours first.</mat-error>
                </mat-form-field>

                <button type="button" [disabled]="moduleCode.invalid" class="fab-button btn btn-success" style="margin-bottom: 10px" (click)="getLectureHoursOfModule()">
                  <mat-icon>add</mat-icon>
                </button>

              </div>

              <mat-form-field appearance="outline" class="input-field" style="width: 100%; font-size: 15px">
                <mat-label>Module Name</mat-label>
                <input type="text" matInput readonly formControlName="moduleName">
              </mat-form-field>

              <mat-form-field appearance="outline" class="input-field" style="width: calc(50% - 10px); margin-right: 10px; font-size: 15px">
                <mat-label>Lecture Hour</mat-label>
                <mat-select id="lectureHours" formControlName="lectureHour" (selectionChange)="getSessions($event.value)">
                  <mat-option *ngFor="let lectureHour of lectureHours" [value]="lectureHour.lectureHourID">{{ lectureHour.type }}</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="input-field" style="width: 50%; font-size: 15px">
                <mat-label>Session</mat-label>
                <mat-select id="sessions" formControlName="session">
                  <mat-option value="0">New Session</mat-option>
                  <mat-option *ngFor="let session of sessions" [value]="session.sessionID">{{ session.dateHeld | date: 'MMM d, y, h:mm a'}}</mat-option>
                </mat-select>
              </mat-form-field>

            </form>

          </div>

        </div>

      </div>

      <div class="tab-pane fade" id="modify-attendance" role="tabpanel" aria-labelledby="modify-attendance-tab">

      </div>

      <div class="tab-pane fade" id="view-attendance" role="tabpanel" aria-labelledby="view-attendance-tab">

      </div>

    </div>
  </div>

  <div *ngIf="filteredAttendance.length === 0 && getRole !== 'admin'" class="alert alert-dark mt-3 mb-0">Mo modules
    found..!
  </div>

  <div *ngIf="error" class="alert alert-danger mt-3 mb-0">Error retrieving the data..!</div>

</div>
