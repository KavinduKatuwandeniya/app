<div class="card composer h-100">

  <div class="card-header bg-primary text-white pb-0 px-2 d-flex justify-content-between">
    <h6 class="mb-0">Write your message</h6>
    <a (click)="userData.toggleComposer()" style="cursor: pointer"><mat-icon class="mb-0 mr-0">close</mat-icon></a>
  </div>

  <div class="card-body p-1">

    <div class="row" style="margin: -20px -20px 10px -20px; height: 5px">
      <mat-progress-bar [hidden]="!composerProgress" mode="query"></mat-progress-bar>
    </div>

    <form [formGroup]="notification">

      <mat-form-field class="col-12 m-0 p-1">
        <mat-chip-list #recipientsList aria-label="Recipients">
          <mat-chip *ngFor="let recipient of recipients" [selectable]="true" [removable]="true" (removed)="remove(recipient.username)">
            <span style="font-size: 12px">{{ recipient.nameWithInitials }}</span>
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input #recipientInput
                 formControlName="recipients"
                 [matAutocomplete]="auto"
                 [matChipInputFor]="recipientsList"
                 [matChipInputSeparatorKeyCodes]="separatorCodes"
                 (matChipInputTokenEnd)="add($event)"
                 placeholder="Recipients">
        </mat-chip-list>
        <mat-autocomplete #auto="matAutocomplete"
                          (optionSelected)="selected($event)">
          <mat-option *ngFor="let recipient of filteredRecipients | async"
                      [value]="recipient.username">
            {{ recipient.username}} | {{ recipient.nameWithInitials }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div *ngIf="invalidRecipient" class="col py-0 px-1" style="margin-top: -20px">
        <small class="text-danger">Invalid recipient</small>
      </div>

      <mat-form-field class="col-12 m-0 p-1">
        <input matInput type="text" formControlName="subject" placeholder="subject"/>
      </mat-form-field>

      <mat-form-field class="col-12 m-0 p-1 h-100">
        <textarea style="resize: none;" rows="5" matInput formControlName="message" placeholder="Type your message"></textarea>
      </mat-form-field>

      <div class="col-12" style="position: absolute; bottom: 10px; left: 0">
        <button (click)="sendNotification()" [disabled]="!message.value || recipients.length === 0" type="button" mat-raised-button color="primary">Send</button>
      </div>

    </form>


  </div>

</div>
